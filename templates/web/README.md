# ç½‘ç»œç›¸å…³å·¥å…·

-   [1. åŒæ­¥HTTPå®¢æˆ·ç«¯](#1-åŒæ­¥httpå®¢æˆ·ç«¯)
-   [2. å¼‚æ­¥HTTPå®¢æˆ·ç«¯](#2-å¼‚æ­¥httpå®¢æˆ·ç«¯)

---

## 1. [åŒæ­¥HTTPå®¢æˆ·ç«¯](request_sync.py)

[`request_sync.py`](request_sync.py) æ˜¯ä¸€ä¸ªåŸºäº `requests` åº“çš„åŒæ­¥ HTTP è¯·æ±‚æ¨¡å—å°è£…ï¼Œé€‚ç”¨äºéœ€è¦ä¼šè¯ç®¡ç†å’Œé‡è¯•æœºåˆ¶çš„å„ç§ Python é¡¹ç›®ï¼Œæä¾›ç®€æ´ç»Ÿä¸€çš„æ¥å£æ”¯æŒ `GET`/`POST`/`PUT`/`DELETE` ç­‰å¸¸ç”¨ HTTP æ–¹æ³•ã€‚

### 1.1 âš™ï¸ ä¸»è¦åŠŸèƒ½

-   âœ… æ”¯æŒåŸºäº Session çš„ä¼šè¯è¯·æ±‚ï¼Œä¿æŒè¿æ¥å’Œ Cookie
-   âœ… æ”¯æŒæ—  Session çš„å•æ¬¡è¯·æ±‚æ¨¡å¼
-   âœ… æ”¯æŒè¯·æ±‚å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼ˆå¯é…ç½®é‡è¯•æ¬¡æ•°ä¸é—´éš”ï¼‰
-   âœ… æ”¯æŒç»Ÿä¸€é…ç½®é»˜è®¤è¯·æ±‚å¤´å’Œè¯·æ±‚è¶…æ—¶
-   âœ… è¿”å›ç»Ÿä¸€çš„å­—å…¸æ ¼å¼ç»“æœï¼ŒåŒ…å«æˆåŠŸæ ‡å¿—ã€çŠ¶æ€ç ã€å“åº”æ•°æ®æˆ–é”™è¯¯ä¿¡æ¯
-   âœ… è‡ªåŠ¨è¯†åˆ« JSON å“åº”å¹¶è§£æä¸º Python å¯¹è±¡
-   âœ… æ”¯æŒ URL è‡ªåŠ¨æ‹¼æ¥åŸºç¡€åœ°å€

### 1.2 ğŸ“¦ ä¾èµ–å®‰è£…

```bash
pip install requests
```

### 1.3 ğŸ“ æ–‡ä»¶ç»“æ„è¯´æ˜

| ç±»/å‡½æ•°             | è¯´æ˜                          |
| ---------------- | --------------------------- |
| `SyncHttpClient` | åŒæ­¥ HTTP è¯·æ±‚å®¢æˆ·ç«¯ç±»å°è£…ï¼Œæ”¯æŒä¼šè¯å’Œå•è¯·æ±‚æ¨¡å¼ |
| `get`            | å‘èµ· GET è¯·æ±‚                   |
| `post`           | å‘èµ· POST è¯·æ±‚                  |
| `put`            | å‘èµ· PUT è¯·æ±‚                   |
| `delete`         | å‘èµ· DELETE è¯·æ±‚                |
| `close`          | å…³é—­ä¼šè¯ï¼ˆå¦‚æœå¯ç”¨äº† Sessionï¼‰         |

### 1.4 ğŸš€ å¿«é€Ÿä½¿ç”¨

```python
from request_sync import SyncHttpClient

client = SyncHttpClient(
    base_url="https://api.example.com",
    default_headers={"User-Agent": "MyApp/1.0"},
    timeout=10,
    retry=2,
    retry_delay=0.5,
    use_session=True,  # æ˜¯å¦å¯ç”¨ä¼šè¯æ¨¡å¼
)

# GET è¯·æ±‚ç¤ºä¾‹
resp = client.get("/users", params={"page": 1})
if resp["success"]:
    print("ç”¨æˆ·åˆ—è¡¨:", resp["data"])
else:
    print("è¯·æ±‚å¤±è´¥:", resp["error"])

# POST è¯·æ±‚ç¤ºä¾‹
resp = client.post("/users", json={"name": "Alice"})
print(resp)

# å…³é—­ä¼šè¯
client.close()
```

### 1.5 `SyncHttpClient` å‚æ•°è¯´æ˜

| å‚æ•°å               | ç±»å‹               | è¯´æ˜                                      |
| ----------------- | ---------------- | --------------------------------------- |
| `base_url`        | `str`            | åŸºç¡€è¯·æ±‚åœ°å€ï¼Œæ‰€æœ‰è¯·æ±‚ URL è‡ªåŠ¨æ‹¼æ¥æ­¤åœ°å€                 |
| `default_headers` | `Dict[str, str]` | é»˜è®¤è¯·æ±‚å¤´ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šï¼Œæ”¯æŒè¦†ç›–                     |
| `timeout`         | `int`            | è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 10 ç§’                       |
| `retry`           | `int`            | è¯·æ±‚å¤±è´¥æ—¶é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 2 æ¬¡                        |
| `retry_delay`     | `float`          | é‡è¯•é—´éš”ç§’æ•°ï¼Œé»˜è®¤ 0.5 ç§’                         |
| `use_session`     | `bool`           | æ˜¯å¦å¯ç”¨ `requests.Session`ï¼Œå¯ç”¨åä¿æŒä¼šè¯ï¼Œé»˜è®¤ True |

### 1.6 ğŸ“ è¿”å›ç»“æœç»“æ„è¯´æ˜

æ‰€æœ‰è¯·æ±‚æ–¹æ³•è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œç¤ºä¾‹ï¼š

```python
{
    "success": True,                   # è¯·æ±‚æ˜¯å¦æˆåŠŸï¼ˆçŠ¶æ€ç  200-299ï¼‰
    "status_code": 200,               # HTTP å“åº”çŠ¶æ€ç 
    "data": {...} or "raw text",      # JSON æ ¼å¼å“åº”æ—¶ä¸ºè§£æåçš„ Python å¯¹è±¡ï¼Œå¦åˆ™ä¸ºæ–‡æœ¬å†…å®¹
}
```

è¯·æ±‚å¤±è´¥æ—¶è¿”å›ç¤ºä¾‹ï¼š

```python
{
    "success": False,
    "status_code": 404,       # å¦‚æœæ— æ³•è·å–çŠ¶æ€ç åˆ™ä¸º None
    "error": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

### 1.7 ğŸ“ æ³¨æ„äº‹é¡¹

-   é»˜è®¤å¯ç”¨ Session æ¨¡å¼ï¼Œé€‚åˆéœ€è¦ç»´æŠ¤ Cookie çš„åœºæ™¯ï¼›å¦‚æœä¸éœ€è¦ï¼Œå¯ä»¥å…³é—­ use_session å‚æ•°ã€‚
-   é‡è¯•æœºåˆ¶é’ˆå¯¹è¯·æ±‚å¼‚å¸¸ï¼ˆç½‘ç»œé”™è¯¯ã€è¶…æ—¶ã€HTTPé”™è¯¯ç­‰ï¼‰ç”Ÿæ•ˆã€‚
-   JSON å“åº”çš„ Content-Type éœ€åŒ…å« application/jsonï¼Œå¦åˆ™è¿”å›åŸå§‹æ–‡æœ¬ã€‚
-   æ—¥å¿—é€šè¿‡ logging è®°å½•è¯·æ±‚å¤±è´¥ä¿¡æ¯ï¼Œå¯æ ¹æ®éœ€æ±‚é…ç½®æ—¥å¿—çº§åˆ«ä¸å¤„ç†å™¨ã€‚
-   å…³é—­å®¢æˆ·ç«¯æ—¶è°ƒç”¨ close() æ–¹æ³•é‡Šæ”¾ Session èµ„æºã€‚

---

## 2. [å¼‚æ­¥HTTPå®¢æˆ·ç«¯](request_async.py)

[`request_async.py`](request_async.py) æ˜¯ä¸€ä¸ªåŸºäº `httpx.AsyncClient` çš„å¼‚æ­¥ HTTP è¯·æ±‚å°è£…æ¨¡å—ï¼Œé€‚ç”¨äº FastAPIã€å¼‚æ­¥çˆ¬è™«ã€å¼‚æ­¥ä»»åŠ¡ç­‰åœºæ™¯ï¼Œæ”¯æŒä¼šè¯å¤ç”¨ã€è‡ªåŠ¨é‡è¯•ã€ç»Ÿä¸€è¿”å›æ ¼å¼ç­‰ç‰¹æ€§ã€‚

### 2.1 âš™ï¸ ä¸»è¦åŠŸèƒ½

-   âœ… ä½¿ç”¨ httpx.AsyncClient å®ç°å¼‚æ­¥è¯·æ±‚
-   âœ… æ”¯æŒåŸºäºä¼šè¯çš„è¿æ¥å¤ç”¨ï¼Œä¹Ÿå¯æŒ‰éœ€å…³é—­
-   âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼ˆè‡ªå®šä¹‰é‡è¯•æ¬¡æ•°ä¸å»¶è¿Ÿï¼‰
-   âœ… æ”¯æŒ GET / POST / PUT / DELETE è¯·æ±‚
-   âœ… è‡ªåŠ¨è¯†åˆ« JSON å“åº”æ ¼å¼å¹¶è§£æ
-   âœ… æ‰€æœ‰è¯·æ±‚ç»“æœç»Ÿä¸€ä¸ºæ ‡å‡†å­—å…¸ç»“æ„
-   âœ… ä¸ asyncio ååŒè¿è¡Œ

### 2.2 ğŸ“¦ å®‰è£…ä¾èµ–

```bash
pip install httpx
```

### 2.3 ğŸ“ æ–‡ä»¶ç»“æ„è¯´æ˜

| ç±»/å‡½æ•°              | è¯´æ˜                   |
| ----------------- | -------------------- |
| `AsyncHttpClient` | å¼‚æ­¥ HTTP è¯·æ±‚å®¢æˆ·ç«¯å°è£…ç±»     |
| `get`             | å¼‚æ­¥ GET è¯·æ±‚            |
| `post`            | å¼‚æ­¥ POST è¯·æ±‚           |
| `put`             | å¼‚æ­¥ PUT è¯·æ±‚            |
| `delete`          | å¼‚æ­¥ DELETE è¯·æ±‚         |
| `close`           | å…³é—­ä¼šè¯è¿æ¥ï¼ˆå¦‚å¯ç”¨äº† Sessionï¼‰ |

### 2.4 ğŸš€ å¿«é€Ÿä½¿ç”¨

```python
import asyncio
from request_async import AsyncHttpClient

async def main():
    client = AsyncHttpClient(
        base_url="https://api.example.com",
        default_headers={"Authorization": "Bearer token"},
        timeout=10,
        retry=2,
        retry_delay=0.5,
        use_session=True
    )

    # å‘èµ·å¼‚æ­¥ GET è¯·æ±‚
    resp = await client.get("/info", params={"q": "demo"})
    if resp["success"]:
        print("æŸ¥è¯¢ç»“æœ:", resp["data"])
    else:
        print("è¯·æ±‚å¤±è´¥:", resp["error"])

    # å‘èµ·å¼‚æ­¥ POST è¯·æ±‚
    resp = await client.post("/submit", json={"name": "Bob"})
    print(resp)

    await client.close()

asyncio.run(main())
```

### 2.5 `AsyncHttpClient` å‚æ•°è¯´æ˜

| å‚æ•°å               | ç±»å‹               | è¯´æ˜                           |
| ----------------- | ---------------- | ---------------------------- |
| `base_url`        | `str`            | è¯·æ±‚åŸºç¡€åœ°å€ï¼Œæ‰€æœ‰ URL ç›¸å¯¹è·¯å¾„è‡ªåŠ¨æ‹¼æ¥æ­¤å‰ç¼€    |
| `default_headers` | `Dict[str, str]` | é»˜è®¤è¯·æ±‚å¤´ï¼Œæ¯æ¬¡è¯·æ±‚ä¼šåˆå¹¶æ·»åŠ               |
| `timeout`         | `int`            | è¯·æ±‚è¶…æ—¶ï¼ˆå•ä½ç§’ï¼‰ï¼Œé»˜è®¤ 10 ç§’            |
| `retry`           | `int`            | è¯·æ±‚å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ 2 æ¬¡           |
| `retry_delay`     | `float`          | æ¯æ¬¡é‡è¯•ä¹‹é—´çš„å»¶è¿Ÿç§’æ•°ï¼Œé»˜è®¤ 0.5 ç§’         |
| `use_session`     | `bool`           | æ˜¯å¦å¯ç”¨ä¼šè¯è¿æ¥å¤ç”¨ï¼Œé»˜è®¤ Trueï¼ˆæ¨èå¼€å¯æé«˜æ€§èƒ½ï¼‰ |

### 2.6 ğŸ“ è¿”å›ç»“æœç»“æ„è¯´æ˜

æ¯ä¸ªè¯·æ±‚æ–¹æ³•å‡è¿”å›å¦‚ä¸‹ç»“æ„çš„å­—å…¸ï¼š

-   è¯·æ±‚æˆåŠŸï¼š

```bash
{
    "success": True,
    "status_code": 200,
    "data": {...}  # JSON å“åº”å†…å®¹ï¼Œæˆ–æ–‡æœ¬å†…å®¹
}
```

-   è¯·æ±‚å¤±è´¥ï¼š

```bash
{
    "success": False,
    "status_code": None,
    "error": "è¿æ¥è¶…æ—¶æˆ–å…¶ä»–å¼‚å¸¸ä¿¡æ¯"
}
```

### 2.7 ğŸ“ æ³¨æ„äº‹é¡¹

-   `httpx.AsyncClient` é»˜è®¤è¿æ¥æ± å’Œ Cookie å¤ç”¨ï¼Œå»ºè®®å¼€å¯ `use_session=True`ï¼›
-   è‹¥ `use_session=False`ï¼Œåˆ™æ¯æ¬¡è¯·æ±‚æ–°å»ºè¿æ¥ï¼Œé€‚åˆä¸´æ—¶æˆ–è½»é‡è¯·æ±‚ï¼›
-   å¼‚æ­¥å‡½æ•°å¿…é¡»è¿è¡Œåœ¨ asyncio åç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚ `asyncio.run(...)`ï¼›
-   è‡ªåŠ¨é‡è¯•æœºåˆ¶é€‚ç”¨äºç½‘ç»œç±»å¼‚å¸¸ï¼Œå¦‚è¶…æ—¶ã€è¿æ¥å¤±è´¥ç­‰ï¼›
-   JSON è‡ªåŠ¨è§£æä¾èµ–äºå“åº”å¤´ä¸­ `Content-Type: application/json`ï¼Œå¦åˆ™è¿”å›æ–‡æœ¬å†…å®¹ï¼›
-   è°ƒç”¨ `client.close()` å¯é‡Šæ”¾èµ„æºï¼Œå»ºè®®åœ¨ç¨‹åºç»“æŸå‰å…³é—­è¿æ¥ã€‚

---
